!function(e){e.fn.jqte=function(t){function s(e,t,s,i,n){var l=a.length+1;return a.push({name:e,cls:l,command:t,key:s,tag:i,emphasis:n})}var i=["0,0,0","68,68,68","102,102,102","153,153,153","204,204,204","238,238,238","243,243,243","255,255,255","244,204,204","252,229,205","255,242,204","217,234,211","208,224,227","207,226,243","217,210,233","234,209,220","234,153,153","249,203,156","255,229,153","182,215,168","162,196,201","159,197,232","180,167,214","213,166,189","224,102,102","246,178,107","255,217,102","147,196,125","118,165,175","111,168,220","142,124,195","194,123,160","255,0,0","255,153,0","255,255,0","0,255,0","0,255,255","0,0,255","153,0,255","255,0,255","204,0,0","230,145,56","241,194,50","106,168,79","69,129,142","61,133,198","103,78,167","166,77,121","153,0,0","180,95,6","191,144,0","56,118,29","19,79,92","11,83,148","53,28,117","116,27,71","102,0,0","120,63,4","127,96,0","39,78,19","12,52,61","7,55,99","32,18,77","76,17,48"],n=e.extend({css:"jqte",title:!0,titletext:[{title:"Font Size"},{title:"Color"},{title:"Bold",hotkey:"B"},{title:"Italic",hotkey:"I"},{title:"Underline",hotkey:"U"},{title:"Ordered List",hotkey:"."},{title:"Unordered List",hotkey:","},{title:"Subscript",hotkey:"down arrow"},{title:"Superscript",hotkey:"up arrow"},{title:"Outdent",hotkey:"left arrow"},{title:"Indent",hotkey:"right arrow"},{title:"Justify Left"},{title:"Justify Center"},{title:"Justify Right"},{title:"Strike Through",hotkey:"K"},{title:"Add Link",hotkey:"L"},{title:"Remove Link"},{title:"Cleaner Style",hotkey:"Delete"},{title:"Horizontal Rule",hotkey:"H"},{title:"Source"}],button:"OK",fsize:!0,fsizes:["10","12","16","18","20","24","28"],funit:"px",color:!0,linktypes:["Web Address","E-mail Address","Picture URL"],b:!0,i:!0,u:!0,ol:!0,ul:!0,sub:!0,sup:!0,outdent:!0,indent:!0,left:!0,center:!0,right:!0,strike:!0,link:!0,unlink:!0,remove:!0,rule:!0,source:!0},t),l=navigator.userAgent.toLowerCase();/msie [1-7]./.test(l)&&(n.title=!1);var a=[];return s("fsize","fSize","","",!1),s("color","colors","","",!1),s("b","Bold","B",["b","strong"],!0),s("i","Italic","I",["i","em"],!0),s("u","Underline","U",["u"],!0),s("ol","insertorderedlist","¾",["ol"],!0),s("ul","insertunorderedlist","¼",["ul"],!0),s("sub","subscript","(",["sub"],!0),s("sup","superscript","&",["sup"],!0),s("outdent","outdent","%",["blockquote"],!1),s("indent","indent","'",["blockquote"],!0),s("left","justifyLeft","","",!1),s("center","justifyCenter","","",!1),s("right","justifyRight","","",!1),s("strike","strikeThrough","K",["strike"],!0),s("link","linkcreator","L",["a"],!0),s("unlink","unlink","",["a"],!1),s("remove","removeformat",".","",!1),s("rule","inserthorizontalrule","H",["hr"],!1),s("source","displaysource","","",!1),this.each(function(){function t(){return window.getSelection?window.getSelection():document.selection&&document.selection.createRange&&"None"!=document.selection.type?document.selection.createRange():void 0}function s(e,s){var i,n=t();window.getSelection?(n.anchorNode&&n.getRangeAt&&(i=n.getRangeAt(0)),i&&(n.removeAllRanges(),n.addRange(i)),l.match(/msie/)||(document.execCommand("StyleWithCSS",!1,!1),document.execCommand(e,!1,s))):document.selection&&document.selection.createRange&&"None"!=document.selection.type&&(i=document.selection.createRange()).execCommand(e,!1,s),c()}function o(s,i,n){if(A.not(":focus")&&A.focus(),window.getSelection){var l,a,o,r=t();r.anchorNode&&r.getRangeAt&&(l=r.getRangeAt(0),a=document.createElement(s),e(a).attr(i,n),o=l.extractContents(),a.appendChild(o),l.insertNode(a),r.removeAllRanges(),c(e(a),"style"==i&&n))}else if(document.selection&&document.selection.createRange&&"None"!=document.selection.type){var d="<"+s+" "+i+'="'+n+'">'+document.selection.createRange().htmlText+"</"+s+">";document.selection.createRange().pasteHTML(d)}}function c(e,t){var s=K();if((s=s||e)&&!t)s.parent().is("[style]")&&s.attr("style",s.parent().attr("style")),s.is("[style]")&&s.find("*").attr("style",s.attr("style"));else if(e&&t&&e.is("[style]")){var i=t.split(";");i=i[0].split(":"),e.find("*").css(i[0],i[1])}}function r(){if(R.data("sourceOpened"))u(!1);else{var t=K(),s="http://";if(u(!0),t)"a"==t.prop("tagName").toLowerCase()&&t.is("[href]")?(s=t.attr("href"),t.attr(U,"")):o("a",U,"");else F.val(s).focus();O.click(function(t){(e(t.target).hasClass(n.css+"_linktypetext")||e(t.target).hasClass(n.css+"_linktypearrow"))&&f(!0)}),T.find("a").click(function(){var t=e(this).attr(n.css+"-linktype");T.data("linktype",t),N.find("."+n.css+"_linktypetext").html(T.find("a:eq("+T.data("linktype")+")").text()),h(s),f()}),h(s),F.val(s).bind("keypress keyup",function(e){if(13==e.keyCode)return d(x.find("["+U+"]")),!1}).focus(),L.click(function(){d(x.find("["+U+"]"))})}}function d(t){F.focus(),function(e){if(e=e[0],document.body.createTextRange)(s=document.body.createTextRange()).moveToElementText(e),s.select();else if(window.getSelection){var t=window.getSelection(),s=document.createRange();"undefined"!=e&&null!=e&&s.selectNodeContents(e),t.removeAllRanges(),t.addRange(s)}}(t),t.removeAttr(U),"2"!=T.data("linktype")?s("createlink",F.val()):(s("insertImage",F.val()),A.find("img").each(function(){var t=e(this).prev("a"),s=e(this).next("a");t.length>0&&""==emptyLinks.html()?t.remove():s.length>0&&""==s.html()&&s.remove(),e(this).is("[style*=float]")||e(this).css({float:"left",margin:"0 10px 10px 0"})})),u(),g()}function u(e){v("["+U+"]:not([href])"),x.find("["+U+"][href]").removeAttr(U),e?(R.data("linkOpened",!0),z.slideDown(100)):(R.data("linkOpened",!1),z.slideUp(100)),f()}function f(e){e?T.stop(!0,!0).delay(100).slideToggle(100):T.stop(!0,!0).delay(100).slideUp(100)}function h(e){var t=T.data("linktype");"1"!=t||"http://"!=F.val()&&!F.is("[value^=http://]")&&F.is("[value^=mailto]")?"1"==t||F.is("[value^=http://]")?F.val(e):F.val("http://"):F.val("mailto:")}function p(t){R.data("sourceOpened")?m(styleField,!1):("fSize"==t?styleField=$:"colors"==t&&(styleField=B),m(styleField,!0),styleField.find("a").click(function(){var s=e(this).attr(n.css+"-styleval");"fSize"==t?(styleType="font-size",s+=n.funit):"colors"==t&&(styleType="color",s="rgb("+s+")");var i=function(e){var t=K();if(t&&t.is("[style]")&&""!=t.css(e)){var s=t.css(e);t.css(e,"");var i=t.attr("style");return t.css(e,s),i}return""}(styleType);o("span","style",styleType+":"+s+";"+i),m("",!1),e("."+n.css+"_title").remove(),g()})),u(!1)}function m(e,t){var s="",i=[{d:"fsizeOpened",f:$},{d:"cpallOpened",f:B}];if(""!=e)for(var n=0;n<i.length;n++)e==i[n].f&&(s=i[n]);if(t){R.data(s.d,!0),s.f.slideDown(100);for(n=0;n<i.length;n++)s.d!=i[n].d&&(R.data(i[n].d,!1),i[n].f.slideUp(100))}else for(n=0;n<i.length;n++)R.data(i[n].d,!1),i[n].f.slideUp(100)}function v(t){x.find(t).each(function(){e(this).before(e(this).html()).remove()})}function y(e){var t,s,i;t=e.replace(/\n/g,"").replace(/\r/g,"").replace(/\t/g,"").replace(/ /g," "),s=[/\<div>(.*?)\<\/div>/gi,/\<br>(.*?)\<br>/gi,/\<br\/>(.*?)\<br\/>/gi,/\<strong>(.*?)\<\/strong>/gi,/\<em>(.*?)\<\/em>/gi],i=["<p>$1</p>","<p>$1</p>","<p>$1</p>","<b>$1</b>","<i>$1</i>"];for(var n=0;n<s.length;n++)t=t.replace(s[n],i[n]);return t}function g(){b.val(y(A.html()))}function k(){A.html(y(b.val()))}function _(t){var s=!1,i=K();return!!i&&(e.each(t,function(t,n){i.prop("tagName").toLowerCase()==n?s=!0:i.parents().each(function(){e(this).prop("tagName").toLowerCase()==n&&(s=!0)})}),s)}var b=e(this),C=e(this).is("[value]")||"textarea"==e(this).prop("tagName").toLowerCase()?e(this).val():e(this).html(),w=e(this).is("[name]")?' name="'+e(this).attr("name")+'"':"";b.after('<div class="'+n.css+'" ></div>');var x=b.next("."+n.css);x.html('<div class="'+n.css+'_toolbar" role="toolbar" unselectable></div><div class="'+n.css+'_linkform" style="display:none" role="dialog"></div><div class="'+n.css+'_editor"></div>');var R=x.find("."+n.css+"_toolbar"),z=x.find("."+n.css+"_linkform"),A=x.find("."+n.css+"_editor"),S=n.css+"_tool_depressed";z.append('<div class="'+n.css+'_linktypeselect" unselectable></div> <input class="'+n.css+'_linkinput" type="text/css" value=""> <div class="'+n.css+'_linkbutton" unselectable>'+n.button+'</div> <div style="height:1px;float:none;clear:both"></div>');var O=z.find("."+n.css+"_linktypeselect"),F=z.find("."+n.css+"_linkinput"),L=z.find("."+n.css+"_linkbutton");O.append('<div class="'+n.css+'_linktypeview" unselectable></div><div class="'+n.css+'_linktypes" role="menu" unselectable></div>');var T=O.find("."+n.css+"_linktypes"),N=O.find("."+n.css+"_linktypeview"),U=n.css+"-setlink";n.css;A.after('<div class="'+n.css+"_source "+n.css+'_hiddenField"><textarea '+w+">"+C+"</textarea></div>"),b.remove();var I=x.find("."+n.css+"_source");b=I.find("textarea"),A.attr("contenteditable","true").html(C);for(var q=0;q<a.length;q++)if(n[a[q].name]){var D=a[q].key.length>0&&null!=n.titletext[q].hotkey&&"undefined"!=n.titletext[q].hotkey&&""!=n.titletext[q].hotkey?" (Ctrl+"+n.titletext[q].hotkey+")":"",H=null!=n.titletext[q].title&&"undefined"!=n.titletext[q].title&&""!=n.titletext[q].title?n.titletext[q].title+D:"";if(R.append('<div class="'+n.css+"_tool "+n.css+"_tool_"+a[q].cls+'" role="button" data-tool="'+q+'" unselectable><a class="'+n.css+'_tool_icon" unselectable></a></div>'),R.find("."+n.css+"_tool[data-tool="+q+"]").data({tag:a[q].tag,command:a[q].command,emphasis:a[q].emphasis,title:H}),"fsize"==a[q].name){R.find("."+n.css+"_tool_"+a[q].cls).append('<div class="'+n.css+'_fontsizes" unselectable style="position:absolute;display:none"></div>');for(var j=0;j<n.fsizes.length;j++)R.find("."+n.css+"_fontsizes").append("<a "+n.css+'-styleval="'+n.fsizes[j]+'" class="'+n.css+'_fontsize" style="font-size:'+n.fsizes[j]+n.funit+'" role="menuitem" unselectable>Abcdefgh...</a>')}else if("color"==a[q].name){R.find("."+n.css+"_tool_"+a[q].cls).append('<div class="'+n.css+'_cpalette" unselectable style="position:absolute;display:none"></div>');for(var E=0;E<i.length;E++)R.find("."+n.css+"_cpalette").append("<a "+n.css+'-styleval="'+i[E]+'" class="'+n.css+'_color" style="background-color: rgb('+i[E]+')" role="gridcell" unselectable></a>')}}T.data("linktype","0");for(q=0;q<3;q++)T.append("<a "+n.css+'-linktype="'+q+'" unselectable>'+n.linktypes[q]+"</a>"),N.html('<div class="'+n.css+'_linktypearrow" unselectable></div><div class="'+n.css+'_linktypetext">'+T.find("a:eq("+T.data("linktype")+")").text()+"</div>");var M="";/msie/.test(l)?M="-ms-":/chrome/.test(l)||/safari/.test(l)||/yandex/.test(l)?M="-webkit-":/mozilla/.test(l)?M="-moz-":/opera/.test(l)?M="-o-":/konqueror/.test(l)&&(M="-khtml-"),x.find("[unselectable]").css(M+"user-select","none").attr("unselectable","on").on("selectstart mousedown",function(e){e.preventDefault()});var W=R.find("."+n.css+"_tool"),$=R.find("."+n.css+"_fontsizes"),B=R.find("."+n.css+"_cpalette"),K=function(){var t,s;if(window.getSelection&&(t=(s=getSelection()).anchorNode),!t&&document.selection){var i=(s=document.selection).getRangeAt?s.getRangeAt(0):s.createRange();t=i.commonAncestorContainer?i.commonAncestorContainer:i.parentElement?i.parentElement():i.item(0)}return!!t&&("#text"==t.nodeName?e(t.parentNode):e(t))};W.click(function(t){"displaysource"!=e(this).data("command")||R.data("sourceOpened")?R.data("sourceOpened")?(R.data("sourceOpened",!1),R.find("."+n.css+"_tool").removeClass(n.css+"_hiddenField"),I.addClass(n.css+"_hiddenField"),A.removeClass(n.css+"_hiddenField"),A.not(":focus")&&A.focus()):"linkcreator"==e(this).data("command")?R.data("linkOpened")?u(!1):r():"fSize"==e(this).data("command")&&!e(t.target).hasClass(n.css+"_fontsize")||"colors"==e(this).data("command")&&!e(t.target).hasClass(n.css+"_color")?p(e(this).data("command")):(A.not(":focus")&&A.focus(),s(e(this).data("command"),null),u(!1),m("",!1),1!=e(this).data("emphasis")||e(this).hasClass(S)?e(this).removeClass(S):e(this).addClass(S),I.addClass(n.css+"_hiddenField"),A.removeClass(n.css+"_hiddenField"),g()):(R.find("."+n.css+"_tool").addClass(n.css+"_hiddenField"),e(this).removeClass(n.css+"_hiddenField"),R.data("sourceOpened",!0),b.css("height",A.outerHeight()),I.removeClass(n.css+"_hiddenField"),A.addClass(n.css+"_hiddenField"),b.focus(),g(),u(!1),m("",!1))}).hover(function(t){if(n.title&&""!=e(this).data("title")&&(e(t.target).hasClass(n.css+"_tool")||e(t.target).hasClass(n.css+"_tool_icon"))){e("."+n.css+"_title").remove(),x.append('<div class="'+n.css+'_title"><div class="'+n.css+'_titleArrow"><div class="'+n.css+'_titleArrowIcon"></div></div><div class="'+n.css+'_titleText">'+e(this).data("title")+"</div></div>");var s=e("."+n.css+"_title:first"),i=(s.find("."+n.css+"_titleArrowIcon"),e(this).position()),l=i.left+e(this).outerWidth()-s.outerWidth()/2-e(this).outerWidth()/2,a=i.top+e(this).outerHeight()+5;s.delay(400).css({top:a,left:l}).fadeIn(200)}},function(){e("."+n.css+"_title").remove()}),A.bind("keypress keyup keydown drop cut copy paste DOMCharacterDataModified DOMSubtreeModified",function(){R.data("sourceOpened")||e(this).trigger("change"),f()}).bind("change",function(){R.data("sourceOpened")||setTimeout(g,0)}).keydown(function(e){if(e.ctrlKey)for(var t=0;t<a.length;t++)if(n[a[t].name]&&e.keyCode==a[t].key.charCodeAt(0))return""!=a[t].command&&"linkcreator"!=a[t].command?s(a[t].command,null):"linkcreator"==a[t].command&&r(),!1}).bind("mouseup keyup",function(t){for(var s=0;s<a.length;s++)n[a[s].name]&&a[s].emphasis&&""!=a[s].tag&&(_(a[s].tag)?R.find("."+n.css+"_tool_"+a[s].cls).addClass(S):e("."+n.css+"_tool_"+a[s].cls).removeClass(S)),m("",!1)}).focus(function(){f()}).focusout(function(){W.removeClass(S),m("",!1),f()}),b.bind("keydown keyup",function(){setTimeout(k,0),e(this).height(e(this)[0].scrollHeight),""==e(this).val()&&e(this).height(0)})})}}(jQuery);